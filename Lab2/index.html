<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Ù„Ø¹Ø¨Ø© XO Ø§Ù„Ø°ÙƒÙŠØ© - Ù…Ø®ØªØ¨Ø± 2</title>
  <style>
    :root{
      --bg1:#0b1220;
      --bg2:#111a2e;
      --card: rgba(255,255,255,.08);
      --card2: rgba(255,255,255,.12);
      --stroke: rgba(255,255,255,.14);
      --text:#f7f8ff;
      --muted: rgba(247,248,255,.75);
      --accent:#7c3aed;
      --accent2:#22c55e;
      --danger:#ef4444;
      --warning:#f59e0b;
      --shadow: 0 18px 45px rgba(0,0,0,.45);
      --radius: 22px;
    }

    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: system-ui, -apple-system, "Segoe UI", Tahoma, Arial, sans-serif;
      color:var(--text);
      min-height:100vh;
      background:
        radial-gradient(1100px 600px at 10% 10%, rgba(124,58,237,.35), transparent 60%),
        radial-gradient(900px 500px at 90% 30%, rgba(34,197,94,.22), transparent 55%),
        radial-gradient(800px 500px at 50% 90%, rgba(245,158,11,.18), transparent 55%),
        linear-gradient(180deg, var(--bg1), var(--bg2));
      display:flex;
      justify-content:center;
    }

    .app{
      width:min(1050px, 94vw);
      padding: 22px 0 0;
      display:flex;
      flex-direction:column;
      min-height:100vh;
    }

    header{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      padding: 10px 6px 18px;
    }

    .brand{
      display:flex;
      align-items:center;
      gap:12px;
    }

    .logo{
      width:44px;height:44px;border-radius:14px;
      background:
        linear-gradient(135deg, rgba(124,58,237,.95), rgba(34,197,94,.8));
      box-shadow: 0 10px 25px rgba(124,58,237,.25);
      display:grid;place-items:center;
      border:1px solid rgba(255,255,255,.18);
    }

    .logo span{
      font-weight:900;
      letter-spacing:.5px;
      filter: drop-shadow(0 10px 12px rgba(0,0,0,.35));
    }

    h1{
      margin:0;
      font-size: 1.15rem;
      line-height:1.2;
    }
    .subtitle{
      margin-top:3px;
      color:var(--muted);
      font-size:.92rem;
    }

    .top-actions{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      justify-content:flex-end;
    }

    button, .chip{
      border:1px solid var(--stroke);
      background: rgba(255,255,255,.08);
      color:var(--text);
      padding: 10px 14px;
      border-radius: 14px;
      cursor:pointer;
      transition:.18s ease;
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      box-shadow: 0 10px 20px rgba(0,0,0,.20);
      font-weight:700;
    }
    button:hover{ transform: translateY(-1px); background: rgba(255,255,255,.12); }
    button:active{ transform: translateY(0px); }

    .btn-primary{
      background: linear-gradient(135deg, rgba(124,58,237,.95), rgba(34,197,94,.75));
      border-color: rgba(255,255,255,.18);
    }
    .btn-primary:hover{ background: linear-gradient(135deg, rgba(124,58,237,1), rgba(34,197,94,.85)); }

    .btn-ghost{ background: rgba(255,255,255,.06); }
    .btn-danger{
      background: rgba(239,68,68,.16);
      border-color: rgba(239,68,68,.35);
    }

    main{
      display:grid;
      grid-template-columns: 1.1fr .9fr;
      gap: 18px;
      align-items:start;
      padding-bottom: 88px; /* Ù…Ø³Ø§Ø­Ø© Ù„Ù„ÙÙˆØªØ± Ø§Ù„Ø«Ø§Ø¨Øª */
    }

    @media (max-width: 860px){
      main{ grid-template-columns: 1fr; }
      header{ flex-direction:column; align-items:stretch; }
      .top-actions{ justify-content:flex-start; }
    }

    .card{
      background: var(--card);
      border:1px solid var(--stroke);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 18px;
      position:relative;
      overflow:hidden;
    }
    .card::before{
      content:"";
      position:absolute; inset:-2px;
      background: radial-gradient(500px 220px at 20% 0%, rgba(124,58,237,.25), transparent 55%),
                  radial-gradient(520px 240px at 90% 10%, rgba(34,197,94,.18), transparent 60%);
      pointer-events:none;
      z-index:0;
    }
    .card > *{ position:relative; z-index:1; }

    .screen-title{
      display:flex; align-items:center; justify-content:space-between; gap:10px;
      margin-bottom: 12px;
    }
    .screen-title h2{ margin:0; font-size:1.05rem; }
    .hint{ color:var(--muted); font-size:.92rem; margin:0; }

    /* start screen */
    .grid-2{
      display:grid;
      grid-template-columns:1fr 1fr;
      gap:12px;
    }
    @media (max-width: 540px){ .grid-2{ grid-template-columns:1fr; } }

    label{ display:block; margin: 8px 0 6px; color: var(--muted); font-weight:700; font-size:.92rem; }
    input, select{
      width:100%;
      padding: 12px 12px;
      border-radius: 14px;
      border:1px solid var(--stroke);
      background: rgba(17,26,46,.55);
      color: var(--text);
      outline:none;
      box-shadow: 0 10px 18px rgba(0,0,0,.18);
    }
    input::placeholder{ color: rgba(247,248,255,.55); }
    select{ cursor:pointer; }

    .row{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      margin-top: 12px;
    }
    .row button{ flex: 1; min-width: 160px; }

    .badge{
      display:inline-flex;
      gap:8px;
      align-items:center;
      padding:8px 12px;
      border-radius: 999px;
      border:1px solid var(--stroke);
      background: rgba(255,255,255,.06);
      color:var(--muted);
      font-weight:800;
      font-size:.9rem;
      margin: 6px 0 10px;
      width: fit-content;
    }
    .dot{
      width:10px;height:10px;border-radius:999px;
      background: var(--accent2);
      box-shadow: 0 0 0 4px rgba(34,197,94,.15);
    }

    /* game */
    .game-top{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      justify-content:space-between;
      align-items:center;
      margin-bottom: 14px;
    }
    .status{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
    }
    .chip{
      cursor:default;
      background: rgba(255,255,255,.06);
      box-shadow:none;
    }
    .chip strong{ color: var(--text); }
    .chip small{ color: var(--muted); font-weight:800; }

    .board{
      margin-top: 10px;
      display:grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 10px;
    }
    .cell{
      aspect-ratio: 1 / 1;
      border-radius: 18px;
      border:1px solid var(--stroke);
      background: rgba(255,255,255,.07);
      display:grid;
      place-items:center;
      font-size: clamp(2.2rem, 4.5vw, 3.2rem);
      font-weight: 900;
      cursor:pointer;
      transition:.15s ease;
      user-select:none;
      box-shadow: 0 10px 22px rgba(0,0,0,.18);
    }
    .cell:hover{ transform: translateY(-1px); background: rgba(255,255,255,.11); }
    .cell:active{ transform: translateY(0px); }
    .cell.disabled{ cursor:not-allowed; opacity:.72; }
    .cell.win{
      background: linear-gradient(135deg, rgba(124,58,237,.35), rgba(34,197,94,.25));
      border-color: rgba(255,255,255,.22);
      transform: scale(1.01);
    }

    .right-panel .stats{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:10px;
      margin-top: 10px;
    }
    .stat{
      padding: 12px;
      border:1px solid var(--stroke);
      border-radius: 18px;
      background: rgba(255,255,255,.06);
    }
    .stat .k{ color: var(--muted); font-weight:900; font-size:.88rem; }
    .stat .v{ margin-top: 6px; font-size:1.1rem; font-weight: 1000; }

    .message{
      margin-top: 10px;
      padding: 12px;
      border-radius: 18px;
      border: 1px dashed rgba(255,255,255,.22);
      background: rgba(17,26,46,.35);
      color: var(--muted);
      line-height: 1.55;
    }

    /* overlay modal */
    .overlay{
      position:fixed;
      inset:0;
      display:none;
      place-items:center;
      background: rgba(0,0,0,.55);
      z-index: 50;
      padding: 16px;
    }
    .overlay.show{ display:grid; }
    .modal{
      width: min(520px, 92vw);
      border-radius: 22px;
      border:1px solid rgba(255,255,255,.18);
      background: rgba(17,26,46,.85);
      backdrop-filter: blur(14px);
      -webkit-backdrop-filter: blur(14px);
      box-shadow: 0 22px 60px rgba(0,0,0,.55);
      padding: 18px;
    }
    .modal h3{ margin: 0 0 8px; }
    .modal p{ margin: 0 0 14px; color: var(--muted); line-height: 1.6; }
    .modal .row{ margin-top: 0; }

    /* footer fixed */
    footer{
      position:fixed;
      left:0; right:0; bottom:0;
      background: rgba(10,16,30,.72);
      border-top: 1px solid rgba(255,255,255,.14);
      backdrop-filter: blur(14px);
      -webkit-backdrop-filter: blur(14px);
      padding: 10px 14px;
      z-index: 60;
    }
    .footer-inner{
      width:min(1050px, 94vw);
      margin:0 auto;
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      justify-content:space-between;
      align-items:center;
      color: rgba(247,248,255,.85);
      font-weight:800;
      font-size: .9rem;
    }
    .footer-inner span{
      color: rgba(247,248,255,.95);
    }
    .footer-inner .muted{
      color: rgba(247,248,255,.72);
      font-weight:900;
    }
  </style>
</head>
<body>
  <div class="app">
    <header>
      <div class="brand">
        <div class="logo" aria-hidden="true"><span>XO</span></div>
        <div>
          <h1>Ù„Ø¹Ø¨Ø© XO Ø§Ù„Ø°ÙƒÙŠØ©</h1>
          <div class="subtitle">Ø·ÙˆØ± Ù„Ø§Ø¹Ø¨ ÙˆØ§Ø­Ø¯ Ø¶Ø¯ Ø§Ù„ÙƒÙ…Ø¨ÙŠÙˆØªØ± Ø£Ùˆ Ø·ÙˆØ± Ù„Ø§Ø¹Ø¨ÙŠÙ† â€” ÙˆØ§Ø¬Ù‡Ø© Ø¹Ø±Ø¨ÙŠØ© ÙˆØªØµÙ…ÙŠÙ… Ø­Ø¯ÙŠØ«</div>
        </div>
      </div>
      <div class="top-actions">
        <button class="btn-ghost" id="btnHow">Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ù„Ø¹Ø¨</button>
        <button class="btn-danger" id="btnResetAll" title="Ø¥Ø¹Ø§Ø¯Ø© Ø¶Ø¨Ø· ÙƒÙ„ Ø´ÙŠØ¡">Ø¥Ø¹Ø§Ø¯Ø© Ø¶Ø¨Ø·</button>
      </div>
    </header>

    <main>
      <!-- Left: start/game card -->
      <section class="card" id="leftCard">
        <!-- Start Screen -->
        <div id="startScreen">
          <div class="screen-title">
            <h2>Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù„Ø¹Ø¨Ø©</h2>
            <div class="badge"><span class="dot"></span> Ø¬Ø§Ù‡Ø²!</div>
          </div>
          <p class="hint">Ø§Ø®ØªØ± Ø¹Ø¯Ø¯ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ†ØŒ Ø«Ù… Ø§ÙƒØªØ¨ Ø§Ù„Ø£Ø³Ù…Ø§Ø¡ØŒ ÙˆØ§Ø¶ØºØ· "Ø§Ø¨Ø¯Ø£".</p>

          <label for="modeSelect">ÙˆØ¶Ø¹ Ø§Ù„Ù„Ø¹Ø¨</label>
          <select id="modeSelect">
            <option value="single">Ù„Ø§Ø¹Ø¨ ÙˆØ§Ø­Ø¯ (Ø¶Ø¯ Ø§Ù„ÙƒÙ…Ø¨ÙŠÙˆØªØ±)</option>
            <option value="two">Ù„Ø§Ø¹Ø¨Ø§Ù† (Ù…Ø­Ù„ÙŠ)</option>
          </select>

          <div class="grid-2">
            <div>
              <label for="p1Name">Ø§Ø³Ù… Ø§Ù„Ù„Ø§Ø¹Ø¨ Ø§Ù„Ø£ÙˆÙ„ (X)</label>
              <input id="p1Name" type="text" placeholder="Ù…Ø«Ø§Ù„: Ø±ÙŠØ§Ø¶" maxlength="18" />
            </div>

            <div>
              <label for="p2Name">Ø§Ø³Ù… Ø§Ù„Ù„Ø§Ø¹Ø¨ Ø§Ù„Ø«Ø§Ù†ÙŠ (O)</label>
              <input id="p2Name" type="text" placeholder="Ù…Ø«Ø§Ù„: ØµØ¯ÙŠÙ‚Ùƒ / Ø§Ù„ÙƒÙ…Ø¨ÙŠÙˆØªØ±" maxlength="18" />
            </div>
          </div>

          <label for="difficulty">Ù…Ø³ØªÙˆÙ‰ Ø§Ù„ÙƒÙ…Ø¨ÙŠÙˆØªØ± (ÙÙŠ Ø·ÙˆØ± Ù„Ø§Ø¹Ø¨ ÙˆØ§Ø­Ø¯)</label>
          <select id="difficulty">
            <option value="easy">Ø³Ù‡Ù„ ğŸ™‚</option>
            <option value="medium" selected>Ù…ØªÙˆØ³Ø· ğŸ˜</option>
            <option value="hard">ØµØ¹Ø¨ ğŸ”¥</option>
          </select>

          <div class="row">
            <button class="btn-primary" id="btnStart">Ø§Ø¨Ø¯Ø£</button>
            <button class="btn-ghost" id="btnDemo">ØªØ¹Ø¨Ø¦Ø© Ø£Ø³Ù…Ø§Ø¡ ØªØ¬Ø±ÙŠØ¨ÙŠØ©</button>
          </div>

          <div class="message" style="margin-top:14px">
            <strong>Ù…Ù„Ø§Ø­Ø¸Ø©:</strong> ÙÙŠ Ø·ÙˆØ± Ø§Ù„Ù„Ø§Ø¹Ø¨ Ø§Ù„ÙˆØ§Ø­Ø¯ØŒ Ø£Ù†Øª ØªÙ„Ø¹Ø¨ Ø¨Ù€ <strong>X</strong> ÙˆØ§Ù„ÙƒÙ…Ø¨ÙŠÙˆØªØ± Ø¨Ù€ <strong>O</strong>.
          </div>
        </div>

        <!-- Game Screen -->
        <div id="gameScreen" style="display:none;">
          <div class="game-top">
            <div class="status">
              <div class="chip" id="chipMode"><small>Ø§Ù„ÙˆØ¶Ø¹:</small> <strong>â€”</strong></div>
              <div class="chip" id="chipTurn"><small>Ø§Ù„Ø¯ÙˆØ±:</small> <strong>â€”</strong></div>
            </div>
            <div class="status">
              <button class="btn-ghost" id="btnNewRound">Ø¬ÙˆÙ„Ø© Ø¬Ø¯ÙŠØ¯Ø©</button>
              <button class="btn-ghost" id="btnBack">ØªØºÙŠÙŠØ± Ø§Ù„Ø£Ø³Ù…Ø§Ø¡</button>
            </div>
          </div>

          <div class="board" id="board" aria-label="Ù„ÙˆØ­Ø© Ù„Ø¹Ø¨Ø© XO">
            <div class="cell" data-i="0" role="button" aria-label="Ø®Ù„ÙŠØ© 1"></div>
            <div class="cell" data-i="1" role="button" aria-label="Ø®Ù„ÙŠØ© 2"></div>
            <div class="cell" data-i="2" role="button" aria-label="Ø®Ù„ÙŠØ© 3"></div>
            <div class="cell" data-i="3" role="button" aria-label="Ø®Ù„ÙŠØ© 4"></div>
            <div class="cell" data-i="4" role="button" aria-label="Ø®Ù„ÙŠØ© 5"></div>
            <div class="cell" data-i="5" role="button" aria-label="Ø®Ù„ÙŠØ© 6"></div>
            <div class="cell" data-i="6" role="button" aria-label="Ø®Ù„ÙŠØ© 7"></div>
            <div class="cell" data-i="7" role="button" aria-label="Ø®Ù„ÙŠØ© 8"></div>
            <div class="cell" data-i="8" role="button" aria-label="Ø®Ù„ÙŠØ© 9"></div>
          </div>

          <div class="message" id="roundMsg">
            Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø£ÙŠ Ù…Ø±Ø¨Ø¹ Ù„Ù„Ø¨Ø¯Ø¡.
          </div>
        </div>
      </section>

      <!-- Right panel -->
      <aside class="card right-panel">
        <div class="screen-title">
          <h2>Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª</h2>
          <p class="hint">Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø¬ÙˆÙ„Ø§Øª ÙˆØªÙØ§ØµÙŠÙ„ Ø³Ø±ÙŠØ¹Ø©</p>
        </div>

        <div class="message" id="playersInfo">
          Ø£Ø¯Ø®Ù„ Ø§Ù„Ø£Ø³Ù…Ø§Ø¡ Ù…Ù† Ø´Ø§Ø´Ø© Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© Ù„Ø¹Ø±Ø¶ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† Ù‡Ù†Ø§.
        </div>

        <div class="stats">
          <div class="stat">
            <div class="k">ÙÙˆØ² Ø§Ù„Ù„Ø§Ø¹Ø¨ X</div>
            <div class="v" id="winsX">0</div>
          </div>
          <div class="stat">
            <div class="k">ÙÙˆØ² Ø§Ù„Ù„Ø§Ø¹Ø¨ O</div>
            <div class="v" id="winsO">0</div>
          </div>
          <div class="stat">
            <div class="k">ØªØ¹Ø§Ø¯Ù„</div>
            <div class="v" id="draws">0</div>
          </div>
          <div class="stat">
            <div class="k">Ø¹Ø¯Ø¯ Ø§Ù„Ø¬ÙˆÙ„Ø§Øª</div>
            <div class="v" id="rounds">0</div>
          </div>
        </div>

        <div class="message" style="margin-top:12px">
          <strong>Ù‚ÙˆØ§Ø¹Ø¯ Ø³Ø±ÙŠØ¹Ø©:</strong><br/>
          Ø§Ù„Ù„Ø§Ø¹Ø¨ Ø§Ù„Ø°ÙŠ ÙŠÙÙƒÙ…Ù„ 3 Ø±Ù…ÙˆØ² Ù…ØªØªØ§Ù„ÙŠØ© (Ø£ÙÙ‚ÙŠ/Ø¹Ù…ÙˆØ¯ÙŠ/Ù‚Ø·Ø±ÙŠ) ÙŠÙÙˆØ².
        </div>
      </aside>
    </main>
  </div>

  <!-- Modal -->
  <div class="overlay" id="overlay" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true">
      <h3>Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ù„Ø¹Ø¨</h3>
      <p>
        Ø§Ø®ØªØ± ÙˆØ¶Ø¹ Ø§Ù„Ù„Ø¹Ø¨ (Ù„Ø§Ø¹Ø¨ ÙˆØ§Ø­Ø¯ Ø£Ùˆ Ù„Ø§Ø¹Ø¨Ø§Ù†)ØŒ Ø£Ø¯Ø®Ù„ Ø§Ù„Ø£Ø³Ù…Ø§Ø¡ØŒ Ø«Ù… Ø§Ø¨Ø¯Ø£.
        ÙÙŠ ÙˆØ¶Ø¹ Ù„Ø§Ø¹Ø¨ ÙˆØ§Ø­Ø¯ Ø³ØªÙ„Ø¹Ø¨ Ø£Ù†Øª Ø¨Ù€ <strong>X</strong> ÙˆØ§Ù„ÙƒÙ…Ø¨ÙŠÙˆØªØ± Ø¨Ù€ <strong>O</strong>.
        ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ø®ØªÙŠØ§Ø± Ù…Ø³ØªÙˆÙ‰ Ø§Ù„ØµØ¹ÙˆØ¨Ø©.
      </p>
      <div class="row">
        <button class="btn-primary" id="btnClose">ÙÙ‡Ù…Øª</button>
      </div>
    </div>
  </div>

  <!-- Mandatory Footer -->
  <footer>
    <div class="footer-inner">
      <div><span>Student Name:</span> <span class="muted">ALKHALIL RIYADH SALEH ALMALKI</span> <span class="muted">(Ø§Ù„Ø®Ù„ÙŠÙ„ Ø±ÙŠØ§Ø¶ ØµØ§Ù„Ø­ Ø§Ù„Ù…Ø§Ù„ÙƒÙŠ)</span></div>
      <div><span>Student ID:</span> <span class="muted">446007251</span></div>
      <div><span>Supervised by:</span> <span class="muted">Mohammed Ahmed Jabali</span></div>
    </div>
  </footer>

  <script>
    // ===== Helpers =====
    const $ = (sel) => document.querySelector(sel);
    const $$ = (sel) => Array.from(document.querySelectorAll(sel));
    const clampName = (s, fallback) => (s && s.trim().length ? s.trim() : fallback);

    // ===== UI Elements =====
    const startScreen = $("#startScreen");
    const gameScreen  = $("#gameScreen");
    const modeSelect  = $("#modeSelect");
    const p1NameInput = $("#p1Name");
    const p2NameInput = $("#p2Name");
    const difficultySelect = $("#difficulty");

    const btnStart    = $("#btnStart");
    const btnDemo     = $("#btnDemo");
    const btnBack     = $("#btnBack");
    const btnNewRound = $("#btnNewRound");
    const btnResetAll = $("#btnResetAll");

    const chipMode = $("#chipMode strong");
    const chipTurn = $("#chipTurn strong");

    const playersInfo = $("#playersInfo");
    const roundMsg = $("#roundMsg");

    const winsXEl = $("#winsX");
    const winsOEl = $("#winsO");
    const drawsEl = $("#draws");
    const roundsEl = $("#rounds");

    const overlay = $("#overlay");
    const btnHow = $("#btnHow");
    const btnClose = $("#btnClose");

    const cells = $$(".cell");

    // ===== Game State =====
    let mode = "single"; // single | two
    let difficulty = "medium"; // easy | medium | hard
    let players = { X: "Ø§Ù„Ù„Ø§Ø¹Ø¨ 1", O: "Ø§Ù„ÙƒÙ…Ø¨ÙŠÙˆØªØ±" };
    let board = Array(9).fill(null);
    let turn = "X";
    let active = false;
    let stats = { winsX: 0, winsO: 0, draws: 0, rounds: 0 };
    let lastWinnerLine = [];

    const WIN_LINES = [
      [0,1,2],[3,4,5],[6,7,8],
      [0,3,6],[1,4,7],[2,5,8],
      [0,4,8],[2,4,6]
    ];

    function setScreen(screen){
      const isStart = screen === "start";
      startScreen.style.display = isStart ? "block" : "none";
      gameScreen.style.display  = isStart ? "none" : "block";
    }

    function updateInfo(){
      chipMode.textContent = mode === "single" ? "Ù„Ø§Ø¹Ø¨ ÙˆØ§Ø­Ø¯" : "Ù„Ø§Ø¹Ø¨Ø§Ù†";
      chipTurn.textContent = `${players[turn]} (${turn})`;

      playersInfo.innerHTML = `
        <strong>Ø§Ù„Ù„Ø§Ø¹Ø¨ X:</strong> ${escapeHtml(players.X)}<br/>
        <strong>Ø§Ù„Ù„Ø§Ø¹Ø¨ O:</strong> ${escapeHtml(players.O)}<br/>
        <span style="color: rgba(247,248,255,.72); font-weight:900;">
          ${mode === "single" ? ("Ù…Ø³ØªÙˆÙ‰ Ø§Ù„ÙƒÙ…Ø¨ÙŠÙˆØªØ±: " + difficultyLabel(difficulty)) : "Ù„Ø¹Ø¨ Ù…Ø­Ù„ÙŠ Ø¨ÙŠÙ† Ù„Ø§Ø¹Ø¨ÙŠÙ†"}
        </span>
      `;

      winsXEl.textContent = stats.winsX;
      winsOEl.textContent = stats.winsO;
      drawsEl.textContent = stats.draws;
      roundsEl.textContent = stats.rounds;
    }

    function difficultyLabel(d){
      if(d === "easy") return "Ø³Ù‡Ù„ ğŸ™‚";
      if(d === "hard") return "ØµØ¹Ø¨ ğŸ”¥";
      return "Ù…ØªÙˆØ³Ø· ğŸ˜";
    }

    function resetBoard(){
      board = Array(9).fill(null);
      turn = "X";
      active = true;
      lastWinnerLine = [];
      cells.forEach(c=>{
        c.textContent = "";
        c.classList.remove("disabled","win");
      });
      roundMsg.innerHTML = `Ø¯ÙˆØ± <strong>${escapeHtml(players[turn])}</strong> â€” Ø§Ø®ØªØ± Ù…Ø±Ø¨Ø¹Ù‹Ø§.`;
      updateInfo();

      // Ù„Ùˆ Ù„Ø§Ø¹Ø¨ ÙˆØ§Ø­Ø¯ ÙˆØ§Ù„ÙƒÙ…Ø¨ÙŠÙˆØªØ± ÙŠØ¨Ø¯Ø£ØŸ Ù„Ø§ØŒ Ø¯Ø§Ø¦Ù…Ù‹Ø§ Ø§Ù„Ù„Ø§Ø¹Ø¨ ÙŠØ¨Ø¯Ø£ Ø¨Ù€ X.
    }

    function fullReset(){
      stats = { winsX: 0, winsO: 0, draws: 0, rounds: 0 };
      mode = "single";
      difficulty = "medium";
      players = { X: "Ø§Ù„Ù„Ø§Ø¹Ø¨ 1", O: "Ø§Ù„ÙƒÙ…Ø¨ÙŠÙˆØªØ±" };
      modeSelect.value = "single";
      difficultySelect.value = "medium";
      p1NameInput.value = "";
      p2NameInput.value = "";
      setScreen("start");
      updateInfo();
    }

    function renderBoard(){
      cells.forEach((c, i)=>{
        c.textContent = board[i] ? board[i] : "";
        c.classList.toggle("disabled", !!board[i] || !active);
      });
    }

    function checkWinner(b){
      for(const line of WIN_LINES){
        const [a,b2,c] = line;
        if(b[a] && b[a] === b[b2] && b[a] === b[c]){
          return { winner: b[a], line };
        }
      }
      if(b.every(v => v !== null)) return { winner: "draw", line: [] };
      return { winner: null, line: [] };
    }

    function endRound(result){
      active = false;
      stats.rounds += 1;

      if(result.winner === "X"){
        stats.winsX += 1;
        roundMsg.innerHTML = `ğŸ‰ ÙØ§Ø² <strong>${escapeHtml(players.X)}</strong>!`;
      } else if(result.winner === "O"){
        stats.winsO += 1;
        roundMsg.innerHTML = `ğŸ† ÙØ§Ø² <strong>${escapeHtml(players.O)}</strong>!`;
      } else {
        stats.draws += 1;
        roundMsg.innerHTML = `ğŸ¤ ØªØ¹Ø§Ø¯Ù„! Ø¬ÙˆÙ„Ø© Ø¬Ù…ÙŠÙ„Ø©.`;
      }

      // highlight winning line
      if(result.line && result.line.length){
        result.line.forEach(i => cells[i].classList.add("win"));
      }

      renderBoard();
      updateInfo();
    }

    function switchTurn(){
      turn = (turn === "X") ? "O" : "X";
      updateInfo();
      roundMsg.innerHTML = `Ø¯ÙˆØ± <strong>${escapeHtml(players[turn])}</strong> â€” Ø§Ø®ØªØ± Ù…Ø±Ø¨Ø¹Ù‹Ø§.`;
    }

    // ===== AI (Computer) =====
    function randomMove(b){
      const empties = b.map((v,i)=> v===null ? i : null).filter(v=>v!==null);
      return empties[Math.floor(Math.random()*empties.length)];
    }

    // Medium: win if possible, block if needed, else random
    function mediumMove(b){
      // try win
      const win = findWinningMove(b, "O");
      if(win !== null) return win;
      // block
      const block = findWinningMove(b, "X");
      if(block !== null) return block;
      // center preference
      if(b[4] === null) return 4;
      // corners preference
      const corners = [0,2,6,8].filter(i=>b[i]===null);
      if(corners.length) return corners[Math.floor(Math.random()*corners.length)];
      return randomMove(b);
    }

    function findWinningMove(b, sym){
      for(const line of WIN_LINES){
        const vals = line.map(i=>b[i]);
        const countSym = vals.filter(v=>v===sym).length;
        const countEmpty = vals.filter(v=>v===null).length;
        if(countSym === 2 && countEmpty === 1){
          const emptyIndexInLine = line[vals.indexOf(null)];
          return emptyIndexInLine;
        }
      }
      return null;
    }

    // Hard: minimax
    function hardMove(b){
      let bestScore = -Infinity;
      let bestMove = null;

      for(let i=0;i<9;i++){
        if(b[i] === null){
          b[i] = "O";
          const score = minimax(b, 0, false);
          b[i] = null;
          if(score > bestScore){
            bestScore = score;
            bestMove = i;
          }
        }
      }
      return bestMove ?? mediumMove(b);
    }

    function minimax(b, depth, isMax){
      const res = checkWinner(b);
      if(res.winner === "O") return 10 - depth;
      if(res.winner === "X") return depth - 10;
      if(res.winner === "draw") return 0;

      if(isMax){
        let best = -Infinity;
        for(let i=0;i<9;i++){
          if(b[i]===null){
            b[i] = "O";
            best = Math.max(best, minimax(b, depth+1, false));
            b[i] = null;
          }
        }
        return best;
      } else {
        let best = Infinity;
        for(let i=0;i<9;i++){
          if(b[i]===null){
            b[i] = "X";
            best = Math.min(best, minimax(b, depth+1, true));
            b[i] = null;
          }
        }
        return best;
      }
    }

    function computerPlay(){
      if(!active) return;
      if(mode !== "single") return;
      if(turn !== "O") return;

      roundMsg.innerHTML = `â³ <strong>${escapeHtml(players.O)}</strong> ÙŠÙÙƒØ±...`;
      updateInfo();

      setTimeout(()=>{
        let move = null;
        if(difficulty === "easy") move = randomMove(board);
        else if(difficulty === "hard") move = hardMove(board);
        else move = mediumMove(board);

        if(move === null || board[move] !== null) return;

        board[move] = "O";
        renderBoard();

        const res = checkWinner(board);
        if(res.winner) endRound(res);
        else {
          switchTurn();
          // Ø¯ÙˆØ± Ø§Ù„Ù„Ø§Ø¹Ø¨
        }
      }, 420);
    }

    // ===== Events =====
    modeSelect.addEventListener("change", ()=>{
      mode = modeSelect.value;
      // ØªÙ„Ù…ÙŠØ­: Ø§Ø³Ù… Ø§Ù„Ù„Ø§Ø¹Ø¨ Ø§Ù„Ø«Ø§Ù†ÙŠ
      if(mode === "single"){
        p2NameInput.placeholder = "Ù…Ø«Ø§Ù„: Ø§Ù„ÙƒÙ…Ø¨ÙŠÙˆØªØ±";
      } else {
        p2NameInput.placeholder = "Ù…Ø«Ø§Ù„: Ø£Ø­Ù…Ø¯";
      }
    });

    btnDemo.addEventListener("click", ()=>{
      p1NameInput.value = "Ø±ÙŠØ§Ø¶";
      p2NameInput.value = modeSelect.value === "two" ? "Ø£Ø­Ù…Ø¯" : "Ø§Ù„ÙƒÙ…Ø¨ÙŠÙˆØªØ±";
    });

    btnStart.addEventListener("click", ()=>{
      mode = modeSelect.value;
      difficulty = difficultySelect.value;

      const p1 = clampName(p1NameInput.value, "Ø§Ù„Ù„Ø§Ø¹Ø¨ 1");
      const p2Default = (mode === "single") ? "Ø§Ù„ÙƒÙ…Ø¨ÙŠÙˆØªØ±" : "Ø§Ù„Ù„Ø§Ø¹Ø¨ 2";
      const p2 = clampName(p2NameInput.value, p2Default);

      players = { X: p1, O: p2 };

      setScreen("game");
      resetBoard();
    });

    btnBack.addEventListener("click", ()=>{
      setScreen("start");
      // Ù„Ø§ Ù†Ù…Ø³Ø­ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø¥Ù„Ø§ Ø¨Ø¥Ø¹Ø§Ø¯Ø© Ø¶Ø¨Ø·
    });

    btnNewRound.addEventListener("click", ()=>{
      resetBoard();
    });

    btnResetAll.addEventListener("click", ()=>{
      const ok = confirm("Ù‡Ù„ ØªØ±ÙŠØ¯ Ø¥Ø¹Ø§Ø¯Ø© Ø¶Ø¨Ø· ÙƒÙ„ Ø´ÙŠØ¡ØŸ Ø³ÙŠØªÙ… Ù…Ø³Ø­ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª ÙˆØ§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø¨Ø¯Ø§ÙŠØ©.");
      if(ok) fullReset();
    });

    cells.forEach(cell=>{
      cell.addEventListener("click", ()=>{
        const i = Number(cell.dataset.i);
        if(!active) return;
        if(board[i] !== null) return;

        // Ù…Ù†Ø¹ Ø§Ù„Ø¶ØºØ· Ø£Ø«Ù†Ø§Ø¡ Ø¯ÙˆØ± Ø§Ù„ÙƒÙ…Ø¨ÙŠÙˆØªØ±
        if(mode === "single" && turn === "O") return;

        board[i] = turn;
        renderBoard();

        const res = checkWinner(board);
        if(res.winner){
          endRound(res);
          return;
        }

        switchTurn();

        // Ø¯ÙˆØ± Ø§Ù„ÙƒÙ…Ø¨ÙŠÙˆØªØ±
        computerPlay();
      });
    });

    // modal
    btnHow.addEventListener("click", ()=> showOverlay(true));
    btnClose.addEventListener("click", ()=> showOverlay(false));
    overlay.addEventListener("click", (e)=>{
      if(e.target === overlay) showOverlay(false);
    });
    document.addEventListener("keydown", (e)=>{
      if(e.key === "Escape") showOverlay(false);
    });

    function showOverlay(show){
      overlay.classList.toggle("show", show);
      overlay.setAttribute("aria-hidden", show ? "false" : "true");
    }

    function escapeHtml(str){
      return String(str)
        .replaceAll("&","&amp;")
        .replaceAll("<","&lt;")
        .replaceAll(">","&gt;")
        .replaceAll('"',"&quot;")
        .replaceAll("'","&#039;");
    }

    // init
    updateInfo();
    modeSelect.dispatchEvent(new Event("change"));
  </script>
</body>
</html>